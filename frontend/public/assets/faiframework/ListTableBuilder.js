class ListTableBuilder{constructor(_0xwu9e2x){this.config=_0xwu9e2x;this.container=document.getElementById(_0xwu9e2x.containerId);this.data=[];this.table=null;this.formBuilder=null;}async init(){if(!this.container){console.error(`Container with ID "${this.config.containerId}" not found.`);return;}this._renderBaseLayout();this.showLoading(true);try{await this._fetchData();this._initDataTable();this._bindGlobalEvents();}catch(error){console.error('Initialization failed:',error);this.container.innerHTML=`<div class="alert alert-danger">Gagal memuat data tabel.</div>`;}finally{this.showLoading(false);}}_renderBaseLayout(){alert();this.container.innerHTML=`
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">Data List</h4>
                <button class="btn btn-primary" id="add-new-btn">
                    <i class="fas fa-plus me-1"></i> Tambah Data Baru
                </button>
            </div>
            <div class="table-responsive">
                <table id="main-datatable" class="table table-striped table-hover w-100"></table>
            </div>
        `;}async _fetchData(){try{const _0xu7h5fa=document.querySelector('meta[name="csrf-token"]').content;const _0xogl9vg=this.config.api_token;const _0xbyts6w=new Headers();_0xbyts6w.append('Authorization',_0xogl9vg);_0xbyts6w.append('Cookie','ci_session=7ub6b26t9omk8mckrvh02qol7cb2jakt');const _0x2whdbc={method:'GET',headers:_0xbyts6w,redirect:'follow'};const _0xbe8x5s=await fetch(`${this.config.backendUrl}${this.config.apiUrl}`,_0x2whdbc);const _0xpsgpq7=await _0xbe8x5s.json().catch(async()=>{const _0xxo9ydf=await _0xbe8x5s.text();try{return JSON.parse(_0xxo9ydf);}catch(_0xkv8iyu){return _0xxo9ydf;}});this.data=Array.isArray(_0xpsgpq7)?_0xpsgpq7:_0xpsgpq7[this.config.apiUrl]||[];}catch(_0xkv8iyu){console.error('Failed to fetch data:',_0xkv8iyu);this.data=[];throw _0xkv8iyu;}}_initDataTable(){const _0xy0ay2r=this._generateTableColumns();if(this.table){this.table.destroy();}console.log(this.data);this.table=$('#main-datatable').DataTable({data:this.data,columns:_0xy0ay2r,responsive:true,language:{url:'//cdn.datatables.net/plug-ins/1.13.6/i18n/id.json',search:'_INPUT_',searchPlaceholder:'Cari data...'},dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>'+'<"row"<"col-sm-12"tr>>'+'<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>'});}_generateTableColumns(){const _0xy0ay2r=[];const _0xc8bu9x=this.config.fieldConfigs.filter(_0x8y7087=>{const _0xfeh8pt=_0x8y7087[2]||'';return _0xfeh8pt.includes('-list')||_0xfeh8pt.includes('-table')||!_0xfeh8pt.includes('-');});_0xc8bu9x.forEach(_0x8y7087=>{const _0xzh979n=_0x8y7087[1];_0xy0ay2r.push({data:_0xzh979n,title:_0x8y7087[0]});});_0xy0ay2r.push({data:null,title:'Aksi',orderable:false,searchable:false,render:(_0xpsgpq7,_0xq702wq,_0xyj3qf2)=>{return`
                    <button class="btn btn-sm btn-info edit-btn" data-id="${_0xyj3qf2.id}" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger delete-btn" data-id="${_0xyj3qf2.id}" title="Hapus">
                        <i class="fas fa-trash"></i>
                    </button>
                `;}});return _0xy0ay2r;}_bindGlobalEvents(){document.getElementById('add-new-btn').addEventListener('click',()=>{this._showFormModal('add');});$('#main-datatable tbody').on('click','.edit-btn',_0xkv8iyu=>{const _0xknh8l5=$(_0xkv8iyu.currentTarget).data('id');const _0xj04aye=this.data.find(_0xv023y0=>_0xv023y0.id==_0xknh8l5);this._showFormModal('edit',_0xj04aye);});$('#main-datatable tbody').on('click','.delete-btn',_0xkv8iyu=>{const _0xknh8l5=$(_0xkv8iyu.currentTarget).data('id');this._handleDelete(_0xknh8l5);});}_showFormModal(_0x24gegz,_0xpsgpq7=null){const _0xn3l3lx=document.getElementById(this.config.modalId);const _0x0xoaml=new bootstrap.Modal(_0xn3l3lx);const _0xmyzzin=_0xn3l3lx.querySelector('.modal-title');const _0x111d18=_0xn3l3lx.querySelector('.modal-body');const _0xqwck58=_0xn3l3lx.querySelector('form');_0xqwck58.reset();_0x111d18.innerHTML='';_0xmyzzin.textContent=_0x24gegz==='add'?'Tambah Data Baru':`Edit Data #${_0xpsgpq7.id}`;const _0x0k012b={viewContext:_0x24gegz==='add'?'tambah':'edit',data:_0xpsgpq7||{},page:{crud:{}}};this.formBuilder=new FormBuilder(_0x0k012b);let _0xa02tdb='';console.log(this.config.fieldConfigs);this.config.fieldConfigs.forEach((_0x2v2b38,_0x6w04yf)=>{console.log(_0x2v2b38);const _0xjmy9am=this.formBuilder.buildField(_0x2v2b38,_0x6w04yf);console.log(_0xjmy9am);if(_0xjmy9am.html){_0x111d18.innerHTML+=_0xjmy9am.html;_0xa02tdb+=_0xjmy9am.js;}});if(_0xa02tdb){const _0xz8x8m2=document.createElement('script');_0xz8x8m2.textContent=_0xa02tdb;_0x111d18.appendChild(_0xz8x8m2);}if(_0x24gegz==='edit'){const _0xmfj3tt=document.createElement('input');_0xmfj3tt.type='hidden';_0xmfj3tt.name='id';_0xmfj3tt.value=_0xpsgpq7.id;_0xqwck58.appendChild(_0xmfj3tt);}_0x0xoaml.show();const _0xdrw655=_0xqwck58.cloneNode(true);_0xqwck58.parentNode.replaceChild(_0xdrw655,_0xqwck58);_0xdrw655.addEventListener('submit',_0xkv8iyu=>{_0xkv8iyu.preventDefault();this._handleFormSubmit(_0xdrw655,_0x0xoaml);});}async _handleFormSubmit(_0xdwzah2,_0x12eol7){const _0xft8cj9=new FormData(_0xdwzah2);const _0xpsgpq7=Object.fromEntries(_0xft8cj9.entries());const _0xw7rj81=!!_0xpsgpq7.id;this.showLoading(true);try{await new Promise(_0xn1vbl7=>setTimeout(_0xn1vbl7,500));if(_0xw7rj81){const _0x6w04yf=this.data.findIndex(_0xv023y0=>_0xv023y0.id==_0xpsgpq7.id);if(_0x6w04yf!==-1){this.data[_0x6w04yf]={...this.data[_0x6w04yf],..._0xpsgpq7};}}else{const _0x1ii0uc=this.data.length>0?Math.max(...this.data.map(_0xsym6h6=>_0xsym6h6.id))+1:1;_0xpsgpq7.id=_0x1ii0uc;this.data.push(_0xpsgpq7);}this.table.clear().rows.add(this.data).draw();_0x12eol7.hide();this.showToast(_0xw7rj81?'Data berhasil diperbarui!':'Data berhasil ditambahkan!');}catch(error){console.error('Form submission failed:',error);this.showToast('Terjadi kesalahan saat menyimpan data.','error');}finally{this.showLoading(false);}}async _handleDelete(_0xknh8l5){const _0xtdn0j9=await Swal.fire({title:'Anda yakin?',text:'Data yang dihapus tidak dapat dikembalikan!',icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',cancelButtonColor:'#3085d6',confirmButtonText:'Ya, hapus!',cancelButtonText:'Batal'});if(_0xtdn0j9.isConfirmed){this.showLoading(true);try{await new Promise(_0xn1vbl7=>setTimeout(_0xn1vbl7,500));this.data=this.data.filter(_0xv023y0=>_0xv023y0.id!=_0xknh8l5);this.table.clear().rows.add(this.data).draw();this.showToast('Data berhasil dihapus.');}catch(error){console.error('Delete failed:',error);this.showToast('Gagal menghapus data.','error');}finally{this.showLoading(false);}}}showLoading(_0xdjvakj){const _0x9a7gwn=document.getElementById('loading-overlay');if(_0x9a7gwn){_0x9a7gwn.style.display=_0xdjvakj?'flex':'none';}}showToast(_0xa3y60t,icon='success'){Swal.fire({toast:true,position:'top-end',icon:icon,title:_0xa3y60t,showConfirmButton:false,timer:3000,timerProgressBar:true});}}